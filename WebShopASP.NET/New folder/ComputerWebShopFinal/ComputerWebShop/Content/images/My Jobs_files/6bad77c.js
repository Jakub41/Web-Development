EOL.namespace("projectPricing");EOL.projectPricing.modelController=(function(){return new Class({Implements:[Events,Options],options:{membershipUpgradeModelVariation:"search"},initialize:function(a){a=a||{};var b=/\/j\/[^/]+\/\d*/;if(b.test(location.pathname)){a.membershipUpgradeModelVariation="job"}else{a.membershipUpgradeModelVariation="search"}this.setOptions(a)},showMembershipUpgradeConfirmationModel:function(d){var a=EOL.utility.urlFromLocation({showUpgradeConfirmationModel:null,upsell:null,free2paid:null},null);this.resetBrowserHistory(a);var c;if(d){c=function(){}}else{c=function(){location.href=a}}var b=new EOL.projectPricing.membershipUpgradeConfirmationModel({onClose:c});b.show()},showMembershipUpgradeModel:function(){var a=EOL.utility.urlFromLocation({showUpgradeModelIfFreeMember:null},null);this.resetBrowserHistory(a);var b=this.getMembershipUpgradeModal();b.show()},getMembershipUpgradeModal:function(c){var b=this;var a=new EOL.membership.UpsellPopupAnchorLess({mode:"pricing",variation:this.options.membershipUpgradeModelVariation,onUpgradeSuccess:function(){b.showMembershipUpgradeConfirmationModel(c);a.hide()}});return a},initializeMembershipUpsellLinks:function(a){$$(a).addEvent("click",function(){EOL.projectPricing.toolTipControllerFactory().doLoggedInUserLearnMoreAction()})},resetBrowserHistory:function(a){if(history&&history.pushState){try{history.pushState({},"",a)}catch(b){}}}})})();EOL.projectPricing.modelControllerFactory=function(a){return new EOL.projectPricing.modelController(a)};window.addEvent("domready",function(){var a=true;EOL.projectPricing.modelControllerFactory().getMembershipUpgradeModal(a)});
EOL.namespace("projectPricing");EOL.projectPricing.membershipUpgradeConfirmationModel=(function(){return new Class({Extends:EOL.modal,options:{id:"membershipUpgradeConfirmationModel",eventTracking:{category:"MembershipUpsell",enabled:true}},initialize:function(a){if(!a.content){a.content='<div class="body"><h1>Upgrade complete!</h1><p>You can now view pricing information on jobs.</p><a href="javascript:void(0);" class="btn-large btn-large-secondary control closeButton">Close</a></div>'}this.parent(a)},update:function(b){this.parent(b);var a=this;$(this).getElement(".control.closeButton").addEvent("click",function(){a.close()})},close:function(){this.hide();this.trackEvent("close");this.fireEvent("close")}})})();
EOL.namespace("projectPricing");EOL.projectPricing.toolTipController=(function(a){var b=a.projectPricing.modelControllerFactory();return new Class({Implements:[Events,Options],options:{},doLoggedInUserLearnMoreAction:function(){b.showMembershipUpgradeModel()},doLoggedOutUserLearnMoreAction:function(){if(Cookie.read("userid")){this.doLoginReturnAction()}else{this.doFreelancerSignupAction()}},doLoggedOutUserLoginAction:function(){this.doLoginReturnAction()},doFreelancerSignupAction:function(){a.utility.freeLancerSignupReturn(a.utility.urlFromLocation({showUpgradeModelIfFreeMember:1}))},doLoginReturnAction:function(){loginReturn(a.utility.urlFromLocation({showUpgradeModelIfFreeMember:1}),true)},initializeAnchors:function(g,c,f,d){var e=this;if(d){$$(d).addEvent("mouseenter:relay("+g+")",function(i,h){e.initializeAnchor(h,c,f)})}else{$$(g).addEvent("mouseenter",function(h){e.initializeAnchor(this,c,f)})}},initializeAnchor:function(f,d,g){if(!f.hasElanceToolTip()){var c=f.getProperty("data-showPricingOverride")=="1";var e={showLoginSection:g,showUpgradeSection:d,isHourly:f.getProperty("data-isHourly")=="1",appendTo:$(document.body)};if(c){delete e.showUpgradeSection;delete e.showLoginSection}if(c||(!g&&!d)){if(f.getProperty("data-lowAmount")){e.lowAmount=f.getProperty("data-lowAmount")}if(f.getProperty("data-avgAmount")){e.avgAmount=f.getProperty("data-avgAmount")}if(f.getProperty("data-highAmount")){e.highAmount=f.getProperty("data-highAmount")}}f.addProjectPricingToolTip(e);f.openElanceToolTip()}}})})(EOL);EOL.projectPricing.toolTipControllerFactory=function(a){return new EOL.projectPricing.toolTipController(a)};
EOL.namespace("projectPricing");EOL.projectPricing.toolTip=(function(b){var a;var c;return new Class({Extends:b.utility.toolTip,options:{type:"standard","class":"averageBubbleToolTip hidePricingToolTip",delayHide:300,arrowPosition:"bottom-left",lowLabel:"Low",lowAmount:null,highLabel:"High",highAmount:null,avgLabel:"Avg",avgAmount:null,showUpgradeSection:false,showLoginSection:false,viewPricingLabel:"View competitive pricing.",goPremiumLabel:"Go Premium",alreadyHaveAccountLabel:"Already upgraded?",loginLabel:"Login",isHourly:true},notApplicableAmount:"n/a",currencyIndicator:"$",initialize:function(f){var e=this;a=b.projectPricing.toolTipControllerFactory();var d={lowAmount:this.notApplicableAmount,avgAmount:this.notApplicableAmount,highAmount:this.notApplicableAmount};this.options=Object.merge({},this.options,d,f);this.options.body=function(){return e.buildBody()};this.parent(f);if(this.isPreview()){this.getTip().addClass("upgrade")}if(this.options.showLoginSection){this.getTip().addClass("login")}},onLearnMore:function(d){d.preventDefault();if(this.options.showLoginSection){a.doLoggedOutUserLearnMoreAction()}else{a.doLoggedInUserLearnMoreAction()}},onLoginLink:function(d){d.preventDefault();a.doLoggedOutUserLoginAction()},isPreview:function(){return this.options.showUpgradeSection?true:false},buildBody:function(){var e=this;var g=new Element("div",{"class":"averageBubble"});var k=new Element("h2",{"class":"competitivePricing"});var h=new Element("div",{"class":"upgradeToPremiumMembershipSection"});var f=new Element("div",{"class":"bidStatContent"});if(e.isPreview()){f.addClass("preview")}var j=new Element("div",{"class":"loginSection"});k.inject(g);f.inject(g);h.inject(g);j.inject(g);h.set("html",'<p class="actions"><a href="#" class="btn-small btn-small-normal goPremiumLink">'+this.options.goPremiumLabel+"</a></p>");h.getElement(".goPremiumLink").addEvent("click",function(l){$el("send","useraction","CLICK","user-membership-upsell",{pageName:"upsell",metricTags:{type:"goPremium"}});e.onLearnMore(l)});j.set("html","<p>"+this.options.alreadyHaveAccountLabel+' <a href="#" class="loginLink">'+this.options.loginLabel+"</a></p>");j.getElement(".loginLink").addEvent("click",function(l){e.onLoginLink(l)});var d=["low","avg","high"];Array.each(d,function(m,l){var n=new Element("div",{"class":"row"});if(l==0){n.addClass("first")}Object.each({left:"Label",right:"Amount"},function(t,p){var q=e.options[m+t];if(t=="Amount"){var r=q;r=r.replace("$","");var s=e.currencyIndicator;if(r==e.notApplicableAmount){s=""}q=r;if(e.isPreview()){q=e.currencyIndicator+'<span class="amountPreview">'+q+"</span>"}else{q=s+q}}var o=new Element("div",{"class":m+t+" "+t.toLowerCase(),html:q});o.inject(n)});if(l==d.length-1){n.addClass("last")}n.inject(f)});var i=g.getElement(".bidStatContent.preview");if(i){i.addEvent("click",function(l){e.onLearnMore(l)})}return g}})})(EOL);var elementPrototype=Browser.Element?Element.prototype:Element.Prototype;elementPrototype.addProjectPricingToolTip=function(b){if(!this.elanceToolTip){var a=Object.merge({},b,{anchor:this});var c=new EOL.projectPricing.toolTip(a);this.elanceToolTip=c}return this};Elements.prototype.addProjectPricingToolTip=function(a){this.each(function(b){b.addProjectPricingToolTip(a)});return this};
EOL.namespace("membership");EOL.membership.UpsellPopup=new Class({options:{onUpgradeSuccess:function(){alert("Please override this function:onUpgradeSuccess to handle the success flow!")},agreeToLeave:true},Implements:[Options,Events],initialize:function(b,a){if(typeof b=="string"){b=$(b)}if(!a){a={}}Asset.css("/styles/membership/upsell.css");var c=this;c.el=b;c.mode=(a.mode)?a.mode:"";c.variation=(a.variation)?a.variation:"job";c.isUpgraded=false;if(a.onUpgradeSuccess){c.options.onUpgradeSuccess=a.onUpgradeSuccess}if(a.onUpgradeComplete){c.options.onUpgradeComplete=a.onUpgradeComplete}c.el.addEvent("click",function(){c.show()});var d=window.location.search.substring(1);if(d){c.query=window.location.search.substring(1).parseQueryString()}else{c.query={}}if(c.query.upsell==c.mode){c.show()}if($("bid_desc-plaintext")){$("bid_desc-plaintext").addEvent("keyup",function(){c.options.agreeToLeave=false})}},show:function(){var c=this;if(!c.dialog){var d=715;var a=(c.mode=="portfolio")?519:440;var b='<img class="upsell-loader" src="/media/images/4.0/ajax-loader.gif" style="position:absolute;top:200px;left:358px"><div class="upsell-content" style="opacity: 0; visibility: hidden;height:100%"></div>';new Element("div",{"class":"upsell-inject",html:b,style:"display:none;"}).inject(c.el);c.dialog=new EOL.dialog(c.el.getElement(".upsell-inject"),{position:"fixed",modal:true,width:d,minHeight:a,className:"upsell-dialog",close:true});c.upsellContent=c.el.getElement(".upsell-content");c.upsellLoader=c.el.getElement(".upsell-loader")}c.loadUpsellContent()},loadUpsellContent:function(){var a=this;if(a.isUpgraded){a.onUpgradeSuccess();return}if(a.isContentLoaded){a.dialog.show();return}new Request({method:"get",url:"/php/membership/main/editMembershipAHR.php",data:{action:"upsell",mode:a.mode,variation:a.variation},onSuccess:function(b){b=JSON.decode(b);if(b.status&&b.status=="success"){a.isContentLoaded=true;if(b.data.html=="P"){a.upsellLoader.fade("out");a.onUpgradeSuccess()}else{a.dialog.show();a.upsellContent.set("html",b.data.html);a.upsellLoader.fade("out");a.upsellContent.fade("in");if(a.upsellContent.getElements(".btn-upgrade")){a.upgradeRequest=new Request({method:"post",url:"/php/membership/main/editMembershipAHR.php",onSuccess:function(c){a.enableUpgrade();c=JSON.decode(c);if(c.status&&c.status=="success"){a.onUpgradeComplete();a.onUpgradeSuccess()}else{if(c.status&&c.status=="error"){var d=c.errorMsgs?c.errorMsgs[0]:null;a.onUpgradeError(d)}else{var d=c.errorMsgs?c.errorMsgs[0]:null;a.onUpgradeFail(d)}}}});a.upsellContent.getElements(".btn-upgrade").addEvent("click",function(){var c;if(this.get("html")=="Add Freelancer Membership"){c="client"}else{c="freelancer"}$el("send","useraction","CLICK","user-membership-upsell",{pageName:"upsell",metricTags:{type:"upgrade",context:c}});a.upgrade()})}a.upsellContent.getElements(".btn-change").addEvent("click",function(){$el("send","useraction","CLICK","user-membership-upsell",{pageName:"upsell",metricTags:{type:"change"}});a.redirect()});if(a.upsellContent.getElements(".btn-cancel")){a.upsellContent.getElements(".btn-cancel").addEvent("click",function(){a.hide()})}if($("clientCatTip")){$("clientCatTip").addElanceToolTip({type:"standard",content:"You'll be able to apply to jobs in the category you select. We'll also email you jobs that match your category."})}if(a.upsellContent.getElement(".category")){a.upsellContent.getElement(".category").addEvent("change",function(){if(this.value==0){a.disableUpgrade()}else{a.enableUpgrade()}})}}}}}).send()},enableUpgrade:function(){var b=this.upsellContent.getElement(".btn-upgrade");var a=b.getNext();b.removeClass("displayNone");a.addClass("displayNone")},disableUpgrade:function(){var b=this.upsellContent.getElement(".btn-upgrade");var a=b.getNext();b.addClass("displayNone");a.removeClass("displayNone")},upgrade:function(){var a=$("upgradeForm").toQueryString();this.upgradeRequest.send(a);this.disableUpgrade()},hide:function(){this.dialog.hide()},onUpgradeComplete:function(){var a=this;if(a.options.onUpgradeComplete){a.options.onUpgradeComplete()}},onUpgradeSuccess:function(){var a=this;a.isUpgraded=true;if(a.options.onUpgradeSuccess){a.options.onUpgradeSuccess()}a.dialog.hide()},onUpgradeError:function(a){this.redirect(a)},onUpgradeFail:function(c){var b=this;b.hide();if(!b.errorDialog){var a='<h1 style="font-weight:400;margin-bottom:10px;">Oops!</h1><div style="margin-bottom:50px;">'+c+'</div><div><a id="upsellFailClose" class="btn-fail-close btn-large btn-large-normal" style="width:40px;text-align:center">OK</a></div>';b.errorDialog=new EOL.dialog(a,{position:"fixed",modal:true,width:450,close:true})}b.errorDialog.show();$("upsellFailClose").addEvent("click",function(){b.errorDialog.hide()})},redirect:function(b){var d=this;d.hide();if(!d.options.agreeToLeave){if(!d.warningDialog){var c='<h1 style="font-weight:400;margin-bottom:10px;">Don\'t forget to save your proposal before upgrading.</h1><div style="margin-bottom:50px;">Be sure to save your proposal on your computer before proceeding. During the upgrade process, your draft will be lost.</div><div><a id="upsellWarningClose" class="btn-large btn-large-normal">Return to Proposal</a><a id="upsellWarningContinue" class="btn-large btn-large-secondary">Proceed Anyway</a></div>';d.warningDialog=new EOL.dialog(c,{position:"fixed",modal:true,width:450,close:true})}d.warningDialog.show();$("upsellWarningClose").addEvent("click",function(){d.warningDialog.hide()});$("upsellWarningContinue").addEvent("click",function(){d.options.agreeToLeave=true;d.redirect(b)});return}var a={mode:"oneclick"};if(!d.query||!d.query.upsell){d.query.upsell=d.mode}var e=window.location.href.split("?")[0];e+="?"+Object.toQueryString(d.query);a.redirect=e;if(b){a.errorText=b}if($("catId")&&$("catId").value){a.catId=$("catId").value}window.location="/php/membership/main/editMembership.php?"+Object.toQueryString(a)}});EOL.membership.UpsellPopupAnchorLess=new Class({Extends:EOL.membership.UpsellPopup,initialize:function(a){var b=new Element("div",{id:String.uniqueID(),"class":"displayNone"}).inject($("eol-ft"));this.parent(b,a)}});